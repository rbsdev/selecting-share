(function(global,doc){"use strict";var selection=doc.selection;var _getSelection=doc.getSelection;var hasSupport=_getSelection||selection;var isNodeList=function(element){var stringRepr=Object.prototype.toString.call(element);return typeof element==="object"&&/^\[object (HTMLCollection|NodeList|Object)\]$/.test(stringRepr)&&element.hasOwnProperty("length")&&(element.length===0||typeof element[0]==="object"&&element[0].nodeType>0)};var debounce=function(callback,wait){var timeout;return function(){var context=this,args=arguments;var later=function(){timeout=null;callback.apply(context,args)};clearTimeout(timeout);timeout=setTimeout(later,wait)}};var Selecting=function(element,callback){this.element=element;this.callback=callback||function(){};this.isTouch="ontouchstart"in global;this.hasLib=global.jQuery&&element instanceof global.jQuery||global.Zepto&&element instanceof global.Zepto};Selecting.prototype={events:function(){var callback=this.callback;var getText=this.getText;this[this.isTouch?"bindTouch":"bindMouseUp"](function(e){callback({text:getText(),event:e})})},getText:function(){var text="";if(_getSelection){text=global.getSelection().toString()}else if(doc.selection&&doc.selection.type!=="Control"){text=doc.selection.createRange().text}return text},checkForSelections:function(element,getText,callback){var intervalCheckingForText;var checkForChanges=function(callback){var currentText=getText();var intervalCheckingForText=setInterval(function(){if(getText()!==currentText){callback(getText());currentText=getText()}else if(getText()===""){clearInterval(intervalCheckingForText)}},100)};var selectionStart=function(){element.removeEventListener("touchend",selectionEnd,false);element.addEventListener("touchend",selectionEnd,false);if(intervalCheckingForText){clearInterval(intervalCheckingForText)}intervalCheckingForText=setInterval(function(){var text=getText();if(text!==""){callback(text);selectionEnd();checkForChanges(callback)}},100)};var selectionEnd=function(){clearInterval(intervalCheckingForText);element.removeEventListener("touchend",selectionEnd,false)};element.addEventListener("touchstart",selectionStart,false)},bindTouch:function(callback){var checkForSelections=this.checkForSelections;var getText=this.getText;if(this.hasLib){this.element.each(function(){checkForSelections(this,getText,callback)});return}var bindDOM=function(el){checkForSelections(el,getText,callback)};if(!isNodeList(this.element)){bindDOM(this.element);return}[].forEach.call(this.element,function(item){bindDOM(item)})},bindMouseUp:function(callback){if(this.hasLib){this.element.on("mouseup",debounce(callback,150));return}var bindDOM=function(el){el.addEventListener("mouseup",debounce(callback,150),false)};if(!isNodeList(this.element)){bindDOM(this.element);return}[].forEach.call(this.element,function(item){bindDOM(item)})}};global.selecting=function(element,callback){if(!hasSupport){return}new Selecting(element,callback).events()}})(window,document);(function(global,doc){"use strict";var isChild=function(element,elementParent){return element.parentNode===elementParent};var SelectingShare=function(params){this.elements={};this.elements.content=params.element;this.url=params.url||document.URL;this.template=["<ul>","<li>",'<a href="http://www.facebook.com/sharer/sharer.php?u={{ URL }}" class="facebook">Facebook</a>',"</li>","<li>",'<a href="{{ TWITTER_URL }}" class="twitter">Twitter</a>',"</li>","</ul>"].join("").replace(/\{\{ URL \}\}/g,this.url)};SelectingShare.prototype={createElement:function(){var element=doc.createElement("div");element.className="selecting-share";element.style.position="absolute";this.cleanElement(element);element.innerHTML=this.template;doc.body.appendChild(element);this.elements.boxShare=element;this.elements.twitter=this.elements.boxShare.querySelector(".twitter");this.elements.facebook=this.elements.boxShare.querySelector(".facebook")},start:function(){this.createElement();var boxShare=this.elements.boxShare;var onSelected=function(result){var text=result.text;var event=result.event;if(!text){this.cleanElement(boxShare);return}this.updateText(text);boxShare.style.top=event.y+"px";boxShare.style.left=event.x+"px"};global.selecting(this.elements.content,onSelected.bind(this));this.event()},updateText:function(text){var twitterURL="http://twitter.com/intent/tweet?text={{ TEXT }} - "+this.url;this.elements.twitter.href=twitterURL.replace("{{ TEXT }}",text)},event:function(){var boxShare=this.elements.boxShare;var content=this.elements.content;doc.addEventListener("mouseup",function(e){if(e.target===content){return}if(isChild(e.target,content)){return}this.cleanElement(boxShare)}.bind(this))},cleanElement:function(boxShare){boxShare.style.top="0px";boxShare.style.left="-9999px"}};global.selectingShare=function(param){new SelectingShare(param).start()}})(window,document);